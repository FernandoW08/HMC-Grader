{% extends "base-layout.html" %}

{% block title %}
Submissions for grading
{% endblock %}

{% block rows %}
<div class="row">
  <div class="col-sm-2">
  </div>
  <div class="col-sm-8">
    <h1>Submissions for: {{course.name}}/{{assignment.name}}/{{problem.name}}</h1>
  </div>
  <div class="col-sm-2">
  </div>
</div>
<div class="row">
  <div class="col-sm-2">
  </div>
  <div class="col-sm-8">
    <a href="{{url_for('grutorGradeRandom', pid=problem.id)}}" class="btn btn-primary"><span class="glyphicon glyphicon-random"></span> Random Grade</a>
  </div>
  <div class="col-sm-2">
  </div>
</div>
<div class="row">
  <div class="col-sm-2">
  </div>
  <div class="col-sm-8">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>{% if not course.anonymousGrading %}Username{% else %}User Identifier{% endif %}</th>
          <th>Submission Status</th>
          <th>Submission Time</th>
          <th>Grade Submission</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users|sort(attribute="username") %}
        <tr>
          <td>{% if not course.anonymousGrading %}{{user.username}}{% else %}{{user.id}}{% endif %}</td>
          {% with sub = problem.getLatestSubmission(user) %}
          {% if sub == None %}
            <td>No Submission</td>
            <td>N/A</td>
            <td><a href="{{url_for('grutorMakeBlank', pid=problem.id, uid=user.id)}}" class="btn btn-primary btn-xs">Grade</a></td>
          {% else %}
            {% with c,text = sub.getStatus() %}
            <td class="{{c}}">{{text}}</td>
            {% endwith %}
            <td class="time {% if sub.isLate %}danger{% endif %}">{{sub.submissionTime.isoformat()}}</td>
            <td><a href="{{url_for('grutorGradeSubmission', pid=problem.id, uid=user.id, subnum=problem.getSubmissionNumber(user))}}" class="btn btn-primary btn-xs">Grade</a></td>
          {% endif %}
          {% endwith %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="col-sm-2">
  </div>
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script src="{{url_for('static', filename='moment.js')}}"></script>
<script>
$(".time").each(function(){
  var t = $(this).text();
  var d = new moment(t+"Z");
  $(this).text(d.format("lll"))
})
</script>
{% endblock %}
